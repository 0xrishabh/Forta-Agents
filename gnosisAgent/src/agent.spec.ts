import  {
  FindingType,
  FindingSeverity,
  Finding,
  createTransactionEvent,
  getJsonRpcUrl,
  TransactionEvent
} from "forta-agent";
import { TestTransactionEvent } from "forta-agent-tools";
import agent from "./agent";


test("executeProposalWithIndex executed", async () => {
  const txEvent: TransactionEvent = new TestTransactionEvent().setData("0x14604b8c00000000000000000000000000000000000000000000000000000000000000e0000000000000000000000000000000000000000000000000000000000000014000000000000000000000000057f1887a8bf19b14fc0df6fd9b2acc9af147ea850000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000018000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002e516d57776f33546b4274557962643777637769783679754774417052343237464243786953474a4e776f77446f4e0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001198752008246c30849803849ca78d3cdf204683715a591c62f3c9ef71cf63710000000000000000000000000000000000000000000000000000000000000004428ed4f6cd0185bc80db4dae66d986f141f5fe4797341406a201f5189027c6e6a775522c80000000000000000000000000a147ddf0817ade664eb9cb343d96a21ed857d1100000000000000000000000000000000000000000000000000000000").setTo("0x1c511d88ba898b4d9cd9113d13b9c360a02fcea1");
  const findings = await agent.handleTransaction(txEvent);
  expect(findings).toStrictEqual([
    Finding.fromObject({
      name: "GNOSIS",
      description: "executeProposalWithIndex execeuted",
      alertId: "FORTA-8",
      severity: FindingSeverity.Info,
      type: FindingType.Info,
      metadata: {
        by: "0x0000000000000000000000000000000000000000",
        to: "0x57f1887a8BF19b14fC0dF6Fd9B2acc9Af147eA85",
        proposalId: "QmWwo3TkBtUybd7wcwix6yuGtApR427FBCxiSGJNwowDoN",
        txHashes: "0x198752008246c30849803849ca78d3cdf204683715a591c62f3c9ef71cf63710",
        value: "0",
        data: "0x28ed4f6cd0185bc80db4dae66d986f141f5fe4797341406a201f5189027c6e6a775522c80000000000000000000000000a147ddf0817ade664eb9cb343d96a21ed857d11",
        operation: "0",
        txIndex: "0"
      }
    }),
  ]);
});